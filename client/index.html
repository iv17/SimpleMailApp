<html>

<head>
	<meta charset="utf-8">
	<title>Simple mail app</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="module" src="js/osc.js"></script>

	<link rel="stylesheet" type="text/css" href="css/styles.css" />
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"
		id="bootstrap-css">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>

	<script type="module">

		import {
			A, Button, EmptyCol, EmptyRow, H1, H2, H3, H4, H5, H6, HR, I, Image,
			InputArea, InputField, Strong, Label, AContainer, ButtonContainer,
			Form, HorizontalPanel, LI, MainPanel, UL, VerticalPanel
		} from './js/osc.js';

		import drawMail from './drawings/drawMail.js';
		import UserManager from './js/managers/UserManager.js';
		import LabelManager from './js/managers/LabelManager.js';
		import MessageManager from './js/managers/MessageManager.js';

		window._api = {}
		window._api.axios = axios;
	
		const url = 'http://localhost:9000';

		const urlParams = new URLSearchParams(window.location.search);
		const code = urlParams.get('code');
		window.a = {}
		window.a.url = url;
		window.a.code = code;
		

		$(document).ready(function () {
			let userManager = new UserManager(axios);
			let labelManager = new LabelManager(axios);
			let messageManager = new MessageManager(axios);
			//window._api.messageManager = messageManager;

			let fetchUser = userManager.fetchUser(url, code);
			let fetchLabels = labelManager.fetchLabels(url, code);
			//let fetchALLMAIL = messageManager.fetchAllMessages(url, code);
			let fetchINBOX = messageManager.fetchMessages(url, code, "INBOX");
			//let fetchSENT = messageManager.fetchMessages(url, code, "SENT");
			let fetchMessage = messageManager.fetchMessage(url, code, "169d45167e07c8d3");
			//let sendMessage = messageManager.sendMessage(url, code, 'ivana.unitedforce@gmail.com', 'Naslov', 'tekst poruke');

			Promise.all([
				fetchUser,
				fetchLabels,
				//fetchALLMAIL,
				fetchINBOX,
				fetchMessage
				//sendMessage
			]).then(response => {
				var mp = new MainPanel('main', '');
				mp.draw(); //SAMO POZOVEM DA SE DODA NA BODY

				var vp1 = new VerticalPanel('vp1', 'container');
				mp.add(vp1);

				vp1 = drawMail(labelManager.labels, messageManager.messages, userManager.user, messageManager.message);
			})
		});

	</script>

</body>

</html>